{% extends "base.html" %}
{% block content %}
<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-narrow">
        <div style="max-width:100%;width:320px;position:sticky;top:3rem;">
          {% if subdirs %}
          <nav class="breadcrumb" aria-label="breadcrumbs">
            <ul>
              <li><a href="/">Root</a></li>
              {% for row in subdirs %}
              {% if not loop.last %}
              <li><a href="?subdir={{row}}">{{row}}</a></li>
              {% else %}
              <li class="is-active"><a href="#" aria-current="page">{{row}}</a></li>
              {% endif %}
              {% endfor %}
            </ul>
          </nav>
          {% endif %}
          <div class="tabs is-toggle">
            <ul>
              <li {% if media_type == 'video' %}class="is-active"{% endif %}><a href="?media_type=video&subdir={{subdir}}">Video</a></li>
              <li {% if media_type == 'image' %}class="is-active"{% endif %}><a href="?media_type=image&subdir={{subdir}}">Image</a></li>
            </ul>
          </div>

          {% if directories %}
          <div class="buttons are-small">
            {% for row in directories %}
            <a class="button is-link is-light" href="?media_type={{media_type}}&subdir={% if subdir %}{{subdir}}/{% endif %}{{row.name}}">{{row.name}}</a>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
      <div class="column">
          <h3 class="title">File List</h3>
    {% if recent %}
    {% if media_type == "video" %}
    <div class="columns is-multiline is-variable is-1">
      {% for row in recent %}
      <div class="column is-one-quarter-tablet is-one-fifth-desktop py-1">
        <div class="card" style="overflow:hidden;">
          <video controls style="width:100%;">
            <source src="/media/{{row.name}}?subdir={{subdir}}" />
          </video>
          <div class="card-content py-2 px-3">
            <p class="is-size-7">{{row.name}}</p>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% elif media_type == "image" %}
    <div class="gallery">
      {% for row in recent %}
      <div class="gallery-item" data-value="/media/{{row.name}}?subdir={{subdir}}"">
        <figure>
          <img style="display:block" src="/media/{{row.name}}?subdir={{subdir}}" />
        </figure>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% else %}
    <p class="block py-6 has-text-grey has-text-centered">Empty.</p>
    {% endif %}
    <footer class="footer">
      <div class="content has-text-centered">
        <p>
          <a href="/tiktok">Tiktok Style</a>
          &nbsp;&nbsp;|&nbsp;&nbsp;
          <a href="https://chanmo.me" target="_blank">Blog</a>
          &nbsp;&nbsp;|&nbsp;&nbsp;
          <a href="https://github.com/ChanMo/fast-media/" target="_blank">Github</a>
          &nbsp;&nbsp;|&nbsp;&nbsp;
          <a href="?theme={% if theme == 'dark' %}light{% else %}dark{% endif %}">{{theme|title}} Theme</a>
        </p>
      </div>
    </footer>
      </div>
    </div>

  </div>
</section>
<div class="modal" id="modal">
  <div class="modal-background"></div>
  <div class="modal-content">
    <p class="image">
      <img src="" alt="">
    </p>
  </div>
  <button class="modal-close is-large" aria-label="close"></button>
</div>
<script>
  (() => {
    const modal = document.getElementById("modal");
    document.querySelectorAll(".gallery-item").forEach(ele => {
      ele.addEventListener("click", () => {
        modal.classList.add('is-active');
        modal.querySelector("img").setAttribute("src", ele.dataset.value);
      })
    });
   
    // Add a click event on various child elements to close the parent modal
    document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button').forEach(($close) => {
      const $target = $close.closest('.modal');
    
      $close.addEventListener('click', () => {
        $target.classList.remove("is-active");
      });
    });
  })();
</script>
{% endblock %}
